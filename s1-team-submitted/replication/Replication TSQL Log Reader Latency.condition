{"ID":"131c8993-ba4e-436e-a4ca-e7da5fcd4197","VersionNumber":5,"Name":"Replication TSQL Log Reader Latency","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.csF6EF92FE{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.cs6BD174F1{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csC1A17A41{color:#0000FF;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Step 1: Check Replication Features are installed</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Step 2: Check if the Server is the Distributor</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Step 3: Return a list of all Replication Log Reader Latency by Publication</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">The cntr_value for the Latency counter is defined in miliseconds. Default setting is 10000 (10 seconds). This must remain true for 10 minutes before the alert will fire. </span><span class=\"csF6EF92FE\">Please update these settings to meet your SLA&#39;s!</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Latency could be increased due to a large number of commands being sent, please cross reference with the condition for commands.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">The following link defines the counters available for monitoring Replication and their definitions: <a class=\"cs6BD174F1\" href=\"https://docs.microsoft.com/en-us/sql/relational-databases/replication/monitor/monitoring-replication-with-system-monitor?view=sql-server-2017\"><span class=\"csC1A17A41\">https://docs.microsoft.com/en-us/sql/relational-databases/replication/monitor/monitoring-replication-with-system-monitor?view=sql-server-2017</span></a></span><a name=\"_dx_frag_StartFragment\"></a><a name=\"_dx_frag_EndFragment\"></a></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">The following link shows how it is possible to send the commands for Stored Procedures across replication rather than the results. This can help to reduce the number of commands sent and therefore the latency, assuming that the surge in commands is the issue.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\"><a class=\"cs6BD174F1\" href=\"https://msdn.microsoft.com/en-us/library/ms152754.aspx\"><span class=\"csC1A17A41\">https://msdn.microsoft.com/en-us/library/ms152754.aspx</span></a></span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"281290ef-d1a9-47f0-a49d-7dd82a5f3a3f\",\"DynamicConditionID\":\"f8ab4a89-eb81-42dd-a139-78065693514e\",\"ID\":\"1\"},{\"OperationTypeID\":\"281290ef-d1a9-47f0-a49d-7dd82a5f3a3f\",\"DynamicConditionID\":\"ad8744e6-adce-423c-a360-3bc02cec0682\",\"ID\":\"2\"},{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"TempDB\",\"Query\":\"SELECT instance_name\\r\\n       , cntr_value\\r\\nFROM   sys.dm_os_performance_counters\\r\\nWHERE  object_name LIKE '%:Replication Logreader%'\\r\\n       AND counter_name = 'Logreader:Delivery Latency'\\r\\nORDER  BY cntr_value DESC; \\r\\n\",\"InstanceType\":1},\"ComparisonType\":3,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"10000\"},\"ID\":\"3\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:01:00","IdlePeriod":"00:10:00","MaximumAllowedDuration":"00:00:05","AntiConditionID":"27fe5b7b-5d41-4785-851c-29839d9437a7","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":100,"ColorIndicator":-13014105,"Severity":1,"Signature":{"ConditionID":"131c8993-ba4e-436e-a4ca-e7da5fcd4197","VersionNumber":5,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"281290ef-d1a9-47f0-a49d-7dd82a5f3a3f\",\"DynamicConditionID\":\"f8ab4a89-eb81-42dd-a139-78065693514e\",\"ID\":\"1\"},{\"OperationTypeID\":\"281290ef-d1a9-47f0-a49d-7dd82a5f3a3f\",\"DynamicConditionID\":\"ad8744e6-adce-423c-a360-3bc02cec0682\",\"ID\":\"2\"},{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"TempDB\",\"Query\":\"SELECT instance_name\\r\\n       , cntr_value\\r\\nFROM   sys.dm_os_performance_counters\\r\\nWHERE  object_name LIKE '%:Replication Logreader%'\\r\\n       AND counter_name = 'Logreader:Delivery Latency'\\r\\nORDER  BY cntr_value DESC; \\r\\n\",\"InstanceType\":1},\"ComparisonType\":3,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"10000\"},\"ID\":\"3\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2019-04-05T19:35:53","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"mj3ckFuI7vHCcxc+W4az5Pu+876QDfdmAvRbCtO2vOfUddHmUtIgyTmOu+Etj4eQabwnk6WwN5IfVLZkptBiNtIdII4987IT5Q/KmYhrX3Ftcf+617YNpoJspERfp9sGBveI8fm9kJDolNm9hhDBDzDK5X7vL9+Rx6fir9Hqqio=","IsSelfPublishedCondition":true},"Tags":null,"Areas":["SQL Server: Activity"],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[{"ID":"f8ab4a89-eb81-42dd-a139-78065693514e","VersionNumber":3,"Name":"Replication is Installed","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Stage 1</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">See if Replication is installed. 1 indicates features have been installed.</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"declare @Retcode int\\r\\nexec @Retcode = [sys].[sp_MS_replication_installed]\\r\\nselect @Retcode\",\"InstanceType\":0},\"ComparisonType\":0,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"1\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:30:00","IdlePeriod":"00:00:30","MaximumAllowedDuration":"00:00:05","AntiConditionID":"b075d8d6-5b76-4de9-a209-20aec528a623","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":100,"ColorIndicator":null,"Severity":1,"Signature":{"ConditionID":"f8ab4a89-eb81-42dd-a139-78065693514e","VersionNumber":3,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"declare @Retcode int\\r\\nexec @Retcode = [sys].[sp_MS_replication_installed]\\r\\nselect @Retcode\",\"InstanceType\":0},\"ComparisonType\":0,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"1\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2019-04-05T19:01:37","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"NYdpkAzuqIVsP1FQ1sr/thlEDBGSVkL1ktkioUWs+ZJwANBaq56r5BA+b+HChcZZDg5pm3qdRsd9CFF2r6grx8Uz1K3u2vIBT+dhvCoDO8gij4RuUx/vBy59LTCYb4nRRRtawYL4KG4qwiLelWzPwfp2jBFbd5vxsjEzUb8TPIQ=","IsSelfPublishedCondition":true},"Tags":"Replication","Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]},{"ID":"ad8744e6-adce-423c-a360-3bc02cec0682","VersionNumber":2,"Name":"Replication is Distributor","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Tests to determine of this is a Distributor for Replication</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @temp TABLE\\r\\n  (\\r\\n     is_installed                      INT,\\r\\n     distribution_server_name          VARCHAR(500),\\r\\n     is_distribution_db_installed      INT,\\r\\n     is_distribution_publisher         INT,\\r\\n     has_remote_distribution_publisher INT\\r\\n  );\\r\\n\\r\\nINSERT @temp\\r\\nEXEC Sp_get_distributor;\\r\\n\\r\\nSELECT is_installed\\r\\nFROM   @temp; \\r\\n\",\"InstanceType\":0},\"ComparisonType\":0,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"1\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:30:00","IdlePeriod":"00:00:00","MaximumAllowedDuration":"00:00:05","AntiConditionID":"9d387139-8e73-4e74-9ced-aae0db403da1","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":100,"ColorIndicator":null,"Severity":1,"Signature":{"ConditionID":"ad8744e6-adce-423c-a360-3bc02cec0682","VersionNumber":2,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @temp TABLE\\r\\n  (\\r\\n     is_installed                      INT,\\r\\n     distribution_server_name          VARCHAR(500),\\r\\n     is_distribution_db_installed      INT,\\r\\n     is_distribution_publisher         INT,\\r\\n     has_remote_distribution_publisher INT\\r\\n  );\\r\\n\\r\\nINSERT @temp\\r\\nEXEC Sp_get_distributor;\\r\\n\\r\\nSELECT is_installed\\r\\nFROM   @temp; \\r\\n\",\"InstanceType\":0},\"ComparisonType\":0,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"1\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2019-04-05T19:01:51","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"hWYHOs2ObIpSvQ+J75easBbznTJp0M/7Rl24gvnaK9aVjsV7zw/abZtF1fseiYVZy7ujtVQ9pKCk1G8sl5XutpMo0RJDQT3HRlF3H9qU3De0onCRlq93Si99ITYNk4/NikdOLs2sbiPV9gVg52Q42i6i4vtg74xUefMZa0ws8Y8=","IsSelfPublishedCondition":true},"Tags":null,"Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]}]}