{"ID":"d4fa4fe5-bfea-4e89-ade4-344ac1fb645b","VersionNumber":15,"Name":"High Number of Failed Logins","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.csE19E36D{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:italic;}\r\n\t\t\t.csF6EF92FE{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.cs6BD174F1{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csC1A17A41{color:#0000FF;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">This condition evaluates to True when there are 10+ failed logins in the last two minutes. The first query ensures that the error log is not more than 2MB (for performance consideration) and the second query checks for the number of failed logins.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">A high number of failed login attempts may indicate that an unauthorized user is trying to access the system. SQL Server Security properties must have </span><span class=\"csE19E36D\">Login auditing</span><span class=\"csBEC5BAA2\"> enabled for this condition to function.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">In SQL Server Management Studio go to Server Properties --&gt; Security page to check on these settings. The </span><span class=\"csE19E36D\">Login auditing</span><span class=\"csBEC5BAA2\"> option must be set to &quot;Failed logins only&quot; or &quot;Both failed and successful logins&quot;.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csF6EF92FE\">See Also:</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\"><a class=\"cs6BD174F1\" href=\"https://msdn.microsoft.com/en-us/library/ms188470.aspx\"><span class=\"csC1A17A41\">https://msdn.microsoft.com/en-us/library/ms188470.aspx</span></a></span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"281290ef-d1a9-47f0-a49d-7dd82a5f3a3f\",\"DynamicConditionID\":\"1b146749-a69f-419f-a90b-b53998d22cfb\",\"ID\":\"1\"},{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"CREATE TABLE #log\\r\\n  (\\r\\n   logdate DATETIME,\\r\\n   info    VARCHAR (25) ,\\r\\n   data    VARCHAR (200)\\r\\n  );\\r\\n\\r\\n  INSERT INTO #log\\r\\n  EXECUTE sp_readerrorlog 0, 1, 'Login failed';\\r\\n\\r\\n  SELECT count(*) AS occurences\\r\\n  FROM   #log\\r\\n  WHERE  logdate > dateadd(minute, -2, getdate());\\r\\n\\r\\n  DROP TABLE #log;\",\"InstanceType\":0},\"ComparisonType\":3,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"10\"},\"ID\":\"2\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:02:00","IdlePeriod":"00:00:00","MaximumAllowedDuration":"00:00:05","AntiConditionID":"118724a8-5707-444a-9e2c-bb9a27faf14e","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":1,"ColorIndicator":null,"Severity":2,"Signature":{"ConditionID":"d4fa4fe5-bfea-4e89-ade4-344ac1fb645b","VersionNumber":15,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"281290ef-d1a9-47f0-a49d-7dd82a5f3a3f\",\"DynamicConditionID\":\"1b146749-a69f-419f-a90b-b53998d22cfb\",\"ID\":\"1\"},{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"CREATE TABLE #log\\r\\n  (\\r\\n   logdate DATETIME,\\r\\n   info    VARCHAR (25) ,\\r\\n   data    VARCHAR (200)\\r\\n  );\\r\\n\\r\\n  INSERT INTO #log\\r\\n  EXECUTE sp_readerrorlog 0, 1, 'Login failed';\\r\\n\\r\\n  SELECT count(*) AS occurences\\r\\n  FROM   #log\\r\\n  WHERE  logdate > dateadd(minute, -2, getdate());\\r\\n\\r\\n  DROP TABLE #log;\",\"InstanceType\":0},\"ComparisonType\":3,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"10\"},\"ID\":\"2\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2018-01-23T19:35:38","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"a2Fle3PDU2tTCeIxqbC7pslZuIlQF3kFfsrOFlywY9xZrA5/GwMZBLdibJSQObP8+j3sPjMLsPRf+K4PMiXoNBwCOIzEBmKQtzk0qD9R0MMyljomVtajPcRXE5FU9r4U6ACx5ge8dkRigXAYOUvN0p7jxDg9hR4ERsqkTuGG7hw=","IsSelfPublishedCondition":true},"Tags":"Auditing","Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[{"ID":"1b146749-a69f-419f-a90b-b53998d22cfb","VersionNumber":2,"Name":"Check Error Log Size","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">Checks the size of the error log. </span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">This condition is used in other custom conditions that query the error log to prevent performance issues associated with larger log files. It should not be enabled or have associated actions.</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @currentlogid int\\r\\nDECLARE @createdate datetime\\r\\nDECLARE @currfilesize int\\r\\n\\r\\nCREATE TABLE #err_log_tmp(ArchiveNo int, CreateDate nvarchar(128), Size int)\\r\\n\\r\\nINSERT #err_log_tmp exec master.dbo.sp_enumerrorlogs\\r\\n\\r\\nSELECT TOP 1\\r\\n      @currentlogid = er.ArchiveNo,\\r\\n      @createdate = CONVERT(datetime, er.CreateDate, 101),\\r\\n      @currfilesize = er.Size\\r\\nFROM #err_log_tmp er\\r\\nORDER BY [ArchiveNo] ASC\\r\\n\\r\\nDROP TABLE #err_log_tmp\\r\\n\\r\\nSELECT @currfilesize;\",\"InstanceType\":0},\"ComparisonType\":5,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"2000000\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"00:00:00","IdlePeriod":"00:00:00","MaximumAllowedDuration":"00:00:30","AntiConditionID":"026b87d7-0eb7-4b38-afa7-425736020c18","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":1,"ColorIndicator":null,"Severity":0,"Signature":{"ConditionID":"1b146749-a69f-419f-a90b-b53998d22cfb","VersionNumber":2,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"DECLARE @currentlogid int\\r\\nDECLARE @createdate datetime\\r\\nDECLARE @currfilesize int\\r\\n\\r\\nCREATE TABLE #err_log_tmp(ArchiveNo int, CreateDate nvarchar(128), Size int)\\r\\n\\r\\nINSERT #err_log_tmp exec master.dbo.sp_enumerrorlogs\\r\\n\\r\\nSELECT TOP 1\\r\\n      @currentlogid = er.ArchiveNo,\\r\\n      @createdate = CONVERT(datetime, er.CreateDate, 101),\\r\\n      @currfilesize = er.Size\\r\\nFROM #err_log_tmp er\\r\\nORDER BY [ArchiveNo] ASC\\r\\n\\r\\nDROP TABLE #err_log_tmp\\r\\n\\r\\nSELECT @currfilesize;\",\"InstanceType\":0},\"ComparisonType\":5,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"2000000\"},\"ID\":\"1\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2018-01-19T18:35:19","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"Uv7JeQzaPOvs9CYKx2azahK4BxxJ1A550aRiS+4WOd+KbTk7wN5TcT2n7KO2bljXbZjcUzIIEDwAIQkW2McS2YM5MhW4p8DMsECjxrfEQdD5xCDkZZX3Tg6y0J9rvDFuVgxAwVkSZglbe6CqP1RlwmpgQzsXlSpSGGjCfayRyFM=","IsSelfPublishedCondition":true},"Tags":"Building Block,Data/Log File","Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]}]}