{"ID":"c8569a7d-d8b3-49ab-b69b-dce4c46ef7c4","VersionNumber":6,"Name":"Tempdb/CPU Configuration Warning > 8 CPUs","Description":"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n\t<head>\r\n\t\t<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" /><title>\r\n\t\t</title>\r\n\t\t<style type=\"text/css\">\r\n\t\t\t.cs2654AE3A{text-align:left;text-indent:0pt;margin:0pt 0pt 0pt 0pt}\r\n\t\t\t.csBEC5BAA2{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;}\r\n\t\t\t.csF6EF92FE{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:bold;font-style:normal;}\r\n\t\t\t.cs6BD174F1{color:#000000;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: none;}\r\n\t\t\t.csC1A17A41{color:#0000FF;background-color:transparent;font-family:Tahoma;font-size:8pt;font-weight:normal;font-style:normal;text-decoration: underline;}\r\n\t\t</style>\r\n\t</head>\r\n\t<body>\r\n\t\t<p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">If you have a large number of cores, you will generally set the number of tempdb files as &frac14; to &frac12; the number of cores. This condition will verify that you have at least the &frac14; ratio. This means if you have 32 cores and 8 files it will evaluate to False, but if there are more than 32 cores and only the 8 default tempdb files, then it will evaluate to True.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">The first query counts the visible online CPUs from sys.dm_os_schedulers and the second query counts the number of tempdb files from sys.master_files.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">You may wish to customize this based on contention or performance issues you have seen in your environments. Keep in mind that Microsoft recommends adding files in multiples of 4, so you would likely want to go from 8 to 12, 16, 20, etc.</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csF6EF92FE\">See Also:</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\"><a class=\"cs6BD174F1\" href=\"https://blogs.sentryone.com/aaronbertrand/sql-server-2016-tempdb-fixes/\"><span class=\"csC1A17A41\">https://blogs.sentryone.com/aaronbertrand/sql-server-2016-tempdb-fixes/</span></a></span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\"><a class=\"cs6BD174F1\" href=\"http://www.sqlskills.com/blogs/paul/a-sql-server-dba-myth-a-day-1230-tempdb-should-always-have-one-data-file-per-processor-core/\"><span class=\"csC1A17A41\">http://www.sqlskills.com/blogs/paul/a-sql-server-dba-myth-a-day-1230-tempdb-should-always-have-one-data-file-per-processor-core/ </span></a></span></p><p class=\"cs2654AE3A\"><span class=\"csBEC5BAA2\">&nbsp;</span></p></body>\r\n</html>\r\n","AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","ConditionCategoryID":"805a84c9-7f1b-4b4d-a9ad-3dddcf9e0f17","OwnerObjectID":"b7c74f24-1a45-4115-8262-d7613878bbd6","OwnerObjectTypeID":"894de672-3fc0-4779-9a0d-880d4c207c77","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(cpu_id) as cpu_count\\r\\nFROM sys.dm_os_schedulers \\r\\nWHERE status = 'VISIBLE ONLINE';\",\"InstanceType\":0},\"ComparisonType\":2,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"8\"},\"ID\":\"1\"},{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(Name) as tempdb_files\\r\\nFROM sys.master_files \\r\\nWHERE database_id = 2\\r\\nAND type_desc <> 'LOG';\",\"InstanceType\":0},\"ComparisonType\":4,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"8\"},\"ID\":\"3\"},{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"2c6a4447-6aae-4a3f-94ec-854e5658775e\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(Name) as tempdb_files\\r\\nFROM sys.master_files \\r\\nWHERE database_id = 2\\r\\nAND type_desc <> 'LOG';\",\"InstanceType\":0},\"ArithmeticCompoundValueOperationType\":3,\"Right\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(cpu_id) as cpu_count\\r\\nFROM sys.dm_os_schedulers \\r\\nWHERE status = 'VISIBLE ONLINE';\",\"InstanceType\":0}},\"ComparisonType\":4,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"0.25\"},\"ID\":\"4\"}],\"BooleanOperationType\":1,\"ID\":\"2\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","EvaluationFrequency":"1.00:00:00","IdlePeriod":"00:00:00","MaximumAllowedDuration":"00:00:05","AntiConditionID":"09f3ea7c-273b-427a-9bb4-49327cb09141","MinWindowsVersion":null,"MaxWindowsVersion":null,"MinSQLServerVersion":null,"MaxSQLServerVersion":null,"MinSSASVersion":null,"MaxSSASVersion":null,"MinVmwareVersion":null,"MaxVmwareVersion":null,"MinSqlDbVersion":null,"MaxSqlDbVersion":null,"MaximumInstanceCount":1,"ColorIndicator":null,"Severity":1,"Signature":{"ConditionID":"c8569a7d-d8b3-49ab-b69b-dce4c46ef7c4","VersionNumber":6,"AppliesToObjectTypeID":"0a11a887-823a-4461-87af-321cad1c3623","RuleDefinition":"{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(cpu_id) as cpu_count\\r\\nFROM sys.dm_os_schedulers \\r\\nWHERE status = 'VISIBLE ONLINE';\",\"InstanceType\":0},\"ComparisonType\":2,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"8\"},\"ID\":\"1\"},{\"OperationTypeID\":\"6c3d38f1-9317-4258-972a-cfee0a0d76b5\",\"Children\":[{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(Name) as tempdb_files\\r\\nFROM sys.master_files \\r\\nWHERE database_id = 2\\r\\nAND type_desc <> 'LOG';\",\"InstanceType\":0},\"ComparisonType\":4,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"8\"},\"ID\":\"3\"},{\"OperationTypeID\":\"8fa3cd6a-960c-43bb-96e0-94092fc2c296\",\"ValueDataTypeID\":\"b35a57f5-b8f6-4e4e-9380-e9d328e3eabf\",\"Left\":{\"ValueTypeID\":\"2c6a4447-6aae-4a3f-94ec-854e5658775e\",\"Left\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(Name) as tempdb_files\\r\\nFROM sys.master_files \\r\\nWHERE database_id = 2\\r\\nAND type_desc <> 'LOG';\",\"InstanceType\":0},\"ArithmeticCompoundValueOperationType\":3,\"Right\":{\"ValueTypeID\":\"aa61ee90-8a95-4fdf-a208-b9a4afa26d9d\",\"Database\":\"master\",\"Query\":\"SELECT count(cpu_id) as cpu_count\\r\\nFROM sys.dm_os_schedulers \\r\\nWHERE status = 'VISIBLE ONLINE';\",\"InstanceType\":0}},\"ComparisonType\":4,\"Right\":{\"ValueTypeID\":\"07f87b7f-c063-47a2-a5be-772ba85ed827\",\"Value\":\"0.25\"},\"ID\":\"4\"}],\"BooleanOperationType\":1,\"ID\":\"2\"}],\"BooleanOperationType\":0,\"ID\":\"0\"}","PublisherID":0,"PublishDateUtc":"2017-10-06T18:25:13","Rights":0,"SignatureVersion":1,"SignaturePublicKey":"<RSAKeyValue><Modulus>uzJQ9gzevXFwOgw/hkcAtD+cA/bBbD1PRzhEZCxbZ6YwjJ1c9bbfXFItLQNwnm8bdWh2k57//qbpEj5DFHOW2EAjHc2Zw5m/vACm6OzelubPS5hbWvzshlaBJKm7KrpWQpPZClx/5eVvUVzOtlz+44RRTiOszObT58acJAQwA70=</Modulus><Exponent>AQAB</Exponent></RSAKeyValue>","Signature":"kUMzbnPIOSXPDZly2DQBghFPJItx+DULVY35mivWWqO2fkG48QiXUXplpGUisRsMvmNiZiFKOHFAQCM2o0lTmmr0kdxIfmZmJa5sSgJPNQVmV4l1XTaz21bR0LBs0zLDWZElmtatwrnl7+ATxE+eWUGs7aWw5XygE4o5bSuW+3k=","IsSelfPublishedCondition":true},"Tags":"Auditing,Performance,UpdateForPublish,11.2.3","Areas":[],"ConditionSystemVersion":3,"MinDBSchemaVersion":null,"MaxDBSchemaVersion":null,"Items":[]}